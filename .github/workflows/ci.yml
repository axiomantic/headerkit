name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v6
        with:
          python-version: "3.12"
          cache: 'pip'
      - run: pip install -e '.[lint]'
      - uses: pre-commit/action@v3.0.1
      - name: stubtest vendored clang bindings
        run: |
          for version in 18 19 20 21; do
            echo "::group::stubtest v${version}"
            python -m mypy.stubtest "headerkit._clang.v${version}.cindex"
            echo "::endgroup::"
          done
          echo "::group::stubtest v18 enumerations"
          python -m mypy.stubtest "headerkit._clang.v18.enumerations"
          echo "::endgroup::"

  test:
    uses: ./.github/workflows/test.yml
